<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小球移动路径记录器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            padding: 20px;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 700px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            margin-bottom: 20px;
            font-size: 2.5rem;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        .step-counter {
            font-size: 1.8rem;
            margin: 20px 0;
            color: #4dff4d;
            font-weight: bold;
        }
        
        .board-container {
            display: inline-block;
            background: #2c3e50;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            margin: 20px auto;
        }
        
        .board {
            border-collapse: collapse;
            margin: 0 auto;
            background: #34495e;
        }
        
        .board td {
            width: 50px;
            height: 50px;
            border: 2px solid #7f8c8d;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .board td:hover {
            background: rgba(52, 152, 219, 0.2);
        }
        
        .ball {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 40px;
            height: 40px;
            background: #3498db;
            border-radius: 50%;
            box-shadow: 0 0 10px #3498db;
            z-index: 2;
        }
        
        .trace {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 40px;
            height: 40px;
            border: 2px dashed #e74c3c;
            border-radius: 50%;
            z-index: 1;
        }
        
        .controls {
            margin: 25px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .direction-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            font-size: 24px;
            border: none;
            border-radius: 50%;
            background: #3498db;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .control-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        #btn-up {
            grid-column: 2;
            grid-row: 1;
        }
        
        #btn-down {
            grid-column: 2;
            grid-row: 3;
        }
        
        #btn-left {
            grid-column: 1;
            grid-row: 2;
        }
        
        #btn-right {
            grid-column: 3;
            grid-row: 2;
        }
        
        .action-btns {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .action-btn {
            padding: 12px 25px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            background: #9b59b6;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .action-btn:hover {
            background: #8e44ad;
            transform: translateY(-3px);
        }
        
        .action-btn:active {
            transform: translateY(1px);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #ffcc00;
        }
        
        .path-display {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            font-size: 1.5rem;
            margin: 20px 0;
            word-break: break-all;
            color: #4dff4d;
            font-family: monospace;
            min-height: 60px;
        }
        
        .modal-btns {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #btn-copy {
            background: #2ecc71;
            color: white;
        }
        
        #btn-copy:hover {
            background: #27ae60;
        }
        
        #btn-close {
            background: #e74c3c;
            color: white;
        }
        
        #btn-close:hover {
            background: #c0392b;
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }
        
        .instructions h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .highlight {
            color: #ffcc00;
            font-weight: bold;
        }
        
        .debug {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ff9999;
            font-size: 0.9rem;
        }
        
        /* 顶部提示条 */
        .top-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 2000;
            transform: translateY(-100%);
            transition: transform 0.3s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .top-alert.show {
            transform: translateY(0);
        }
        
        /* 键盘提示 */
        .keyboard-hint {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 1rem;
            color: #ffcc00;
        }
    </style>
</head>
<body>
    <!-- 顶部提示条 -->
    <div class="top-alert" id="top-alert"></div>
    
    <div class="container">
        <h1>小球移动路径记录器</h1>
        
        <div class="step-counter">移动步数: <span id="step-count">0</span></div>
        
        <div class="board-container">
            <table class="board" id="game-board">
                <!-- 7x7棋盘由JS动态生成 -->
            </table>
        </div>
        
        <div class="controls">
            <div class="direction-controls">
                <button class="control-btn" id="btn-up">↑</button>
                <button class="control-btn" id="btn-left">←</button>
                <button class="control-btn" id="btn-down">↓</button>
                <button class="control-btn" id="btn-right">→</button>
            </div>
            
            <div class="action-btns">
                <button class="action-btn" id="btn-undo">撤回</button>
                <button class="action-btn" id="btn-output">输出路径</button>
                <button class="action-btn" id="btn-reset">重置</button>
            </div>
            
            <div class="keyboard-hint">
                键盘控制: W(上) S(下) A(左) D(右)
            </div>
        </div>
    </div>
    
    <!-- 路径输出弹窗 -->
    <div class="modal" id="path-modal">
        <div class="modal-content">
            <h2>移动路径序列</h2>
            <div class="path-display" id="path-display"></div>
            <div class="modal-btns">
                <button class="modal-btn" id="btn-copy">复制路径</button>
                <button class="modal-btn" id="btn-close">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 重置确认弹窗 -->
    <div class="modal" id="reset-modal">
        <div class="modal-content">
            <h2>重置确认</h2>
            <div class="path-display">确定要重置游戏吗？这将清空所有移动记录！</div>
            <div class="modal-btns">
                <button class="modal-btn" id="btn-reset-confirm">确定</button>
                <button class="modal-btn" id="btn-reset-cancel">取消</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 游戏状态变量
            let board = [];
            let currentPosition = null;
            let lastPosition = null;
            let moves = [];
            let moveHistory = []; // 存储每一步的位置，用于撤回
            let stepCount = 0;
            let gameStarted = false;
            const boardSize = 7;
            
            const boardElement = document.getElementById('game-board');
            const stepCountElement = document.getElementById('step-count');
            const pathDisplayElement = document.getElementById('path-display');
            const pathModalElement = document.getElementById('path-modal');
            const resetModalElement = document.getElementById('reset-modal');
            const topAlertElement = document.getElementById('top-alert');
            
            // 初始化棋盘
            function initializeBoard() {
                boardElement.innerHTML = '';
                board = [];
                
                for (let i = 0; i < boardSize; i++) {
                    const row = document.createElement('tr');
                    board[i] = [];
                    
                    for (let j = 0; j < boardSize; j++) {
                        const cell = document.createElement('td');
                        cell.dataset.row = i;
                        cell.dataset.col = j;
                        
                        // 添加点击事件 - 放置初始小球
                        cell.addEventListener('click', () => {
                            if (!gameStarted) {
                                placeBall(i, j);
                                gameStarted = true;
                                // 存储初始位置到历史记录
                                moveHistory.push({row: i, col: j});
                                // 移除所有单元格的点击事件
                                document.querySelectorAll('.board td').forEach(cell => {
                                    cell.style.pointerEvents = 'none';
                                });
                            }
                        });
                        
                        row.appendChild(cell);
                        board[i][j] = cell;
                    }
                    
                    boardElement.appendChild(row);
                }
            }
            
            // 放置初始小球
            function placeBall(row, col) {
                currentPosition = { row, col };
                
                const ball = document.createElement('div');
                ball.className = 'ball';
                board[row][col].appendChild(ball);
            }
            
            // 移动小球
            function moveBall(direction) {
                if (!gameStarted) {
                    showTopAlert('请先点击棋盘放置小球！');
                    return;
                }
                
                const newPosition = { ...currentPosition };
                
                // 计算新位置
                switch(direction) {
                    case 'up': newPosition.row--; break;
                    case 'down': newPosition.row++; break;
                    case 'left': newPosition.col--; break;
                    case 'right': newPosition.col++; break;
                }
                
                // 检查边界
                if (newPosition.row < 0 || newPosition.row >= boardSize || 
                    newPosition.col < 0 || newPosition.col >= boardSize) {
                    showTopAlert('不能移动到边界外！');
                    return;
                }
                
                // 记录移动
                moves.push(directionToNumber(direction));
                stepCount++;
                stepCountElement.textContent = stepCount;
                
                // 更新位置
                lastPosition = currentPosition;
                currentPosition = newPosition;
                // 保存到历史记录
                moveHistory.push({...currentPosition});
                
                // 更新棋盘显示
                updateBoard();
            }
            
            // 更新棋盘显示
            function updateBoard() {
                // 清除棋盘上的所有小球和轨迹
                for (let i = 0; i < boardSize; i++) {
                    for (let j = 0; j < boardSize; j++) {
                        board[i][j].innerHTML = '';
                    }
                }
                
                // 显示上一步轨迹（如果有）
                if (lastPosition) {
                    const trace = document.createElement('div');
                    trace.className = 'trace';
                    board[lastPosition.row][lastPosition.col].appendChild(trace);
                }
                
                // 显示当前位置小球
                const ball = document.createElement('div');
                ball.className = 'ball';
                board[currentPosition.row][currentPosition.col].appendChild(ball);
            }
            
            // 方向到数字的转换
            function directionToNumber(direction) {
                switch(direction) {
                    case 'up': return 1;
                    case 'down': return 2;
                    case 'left': return 3;
                    case 'right': return 4;
                }
            }
            
            // 显示路径弹窗
            function showPath() {
                if (!gameStarted) {
                    showTopAlert('请先放置小球并移动！');
                    return;
                }
                
                if (moves.length === 0) {
                    pathDisplayElement.textContent = '尚未移动';
                } else {
                    pathDisplayElement.textContent = moves.join('');
                }
                
                pathModalElement.style.display = 'flex';
            }
            
            // 复制路径
            function copyPath() {
                const text = moves.length > 0 ? moves.join('') : '';
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showTopAlert('路径已复制到剪贴板！');
                    })
                    .catch(err => {
                        console.error('复制失败:', err);
                        showTopAlert('复制失败，请手动复制');
                    });
            }
            
            // 撤回操作
            function undoMove() {
                if (!gameStarted) {
                    showTopAlert('游戏尚未开始！');
                    return;
                }
                
                if (moveHistory.length <= 1) {
                    showTopAlert('无法撤回，已回到初始位置！');
                    return;
                }
                
                // 移除当前位置
                moveHistory.pop();
                // 移除最后一个移动记录
                moves.pop();
                stepCount--;
                stepCountElement.textContent = stepCount;
                
                // 更新位置
                currentPosition = {...moveHistory[moveHistory.length - 1]};
                lastPosition = moveHistory.length > 1 ? {...moveHistory[moveHistory.length - 2]} : null;
                
                // 更新棋盘
                updateBoard();
                showTopAlert('已撤回上一步操作');
            }
            
            // 重置游戏
            function resetGame() {
                resetModalElement.style.display = 'flex';
            }
            
            // 执行重置
            function performReset() {
                currentPosition = null;
                lastPosition = null;
                moves = [];
                moveHistory = [];
                stepCount = 0;
                gameStarted = false;
                stepCountElement.textContent = stepCount;
                
                // 重新初始化棋盘（允许点击放置小球）
                initializeBoard();
                resetModalElement.style.display = 'none';
                showTopAlert('游戏已重置，请放置初始小球');
            }
            
            // 显示顶部提示条
            function showTopAlert(message) {
                topAlertElement.textContent = message;
                topAlertElement.classList.add('show');
                
                // 2秒后自动隐藏
                setTimeout(() => {
                    topAlertElement.classList.remove('show');
                }, 2000);
            }
            
            // 事件监听
            document.getElementById('btn-up').addEventListener('click', () => moveBall('up'));
            document.getElementById('btn-down').addEventListener('click', () => moveBall('down'));
            document.getElementById('btn-left').addEventListener('click', () => moveBall('left'));
            document.getElementById('btn-right').addEventListener('click', () => moveBall('right'));
            document.getElementById('btn-output').addEventListener('click', showPath);
            document.getElementById('btn-copy').addEventListener('click', copyPath);
            document.getElementById('btn-close').addEventListener('click', () => {
                pathModalElement.style.display = 'none';
            });
            document.getElementById('btn-undo').addEventListener('click', undoMove);
            document.getElementById('btn-reset').addEventListener('click', resetGame);
            document.getElementById('btn-reset-confirm').addEventListener('click', performReset);
            document.getElementById('btn-reset-cancel').addEventListener('click', () => {
                resetModalElement.style.display = 'none';
            });
            
            // 键盘事件监听
            document.addEventListener('keydown', (e) => {
                switch(e.key.toLowerCase()) {
                    case 'w': moveBall('up'); break;
                    case 's': moveBall('down'); break;
                    case 'a': moveBall('left'); break;
                    case 'd': moveBall('right'); break;
                }
            });
            
            // 初始化游戏
            initializeBoard();
        });
    </script>
</body>
</html>
